<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ocean</title>

    <link rel="stylesheet" th:href="@{/css/lnb.css}">
    <link rel="stylesheet" th:href="@{/css/wsmain.css}">
    <link rel="stylesheet" th:href="@{/css/rnb.css}">
    <link rel="stylesheet" th:href="@{/css/invite.css}">

    <style>
        .modal {
    position: fixed;
    z-index: 1000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: #fff;
    padding: 30px;
    border-radius: 12px;
    width: 320px;
    position: relative;
    text-align: center;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}

.close-button {
    position: absolute;
    right: 15px;
    top: 15px;
    font-size: 20px;
    cursor: pointer;
}

.mini-profile-container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 10px 20px;
}

.mini-profile-summary {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}

.mini-profile-summary img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
}

.mini-profile-info {
    font-size: 14px;
}

.mini-profile-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 0;
    width: 150px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    z-index: 10;
}

.mini-profile-menu ul {
    list-style: none;
    margin: 0;
    padding: 0;
}

.mini-profile-menu li {
    padding: 10px;
    text-align: center;
    cursor: pointer;
}

.mini-profile-menu li:hover {
    background-color: #f0f0f0;
}

        .status-modal {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 4px;
    background: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 6px 0;
    width: 120px;
    z-index: 1000; /* ì¤‘ìš”! */
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
</style>
</head>
<body>

<!-- ì™¼ìª½ ì‚¬ì´ë“œë°” (LNB) -->
<div th:replace="~{fragments/lnb :: lnbFragment}"></div>

<!-- ë©”ì¸ ì½˜í…ì¸  -->
<div class="main">

    <div class="top-banner">
        <div class="title">í”„ë¡œì íŠ¸ ë§ˆê°ê¹Œì§€</div>
        <div class="d-day">D-21</div>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <div class="date">6ì›” 10ì¼ í™”ìš”ì¼</div>
    </div>

    <div class="main-section">
        <div class="schedule">
            <h2>ì˜¤ëŠ˜ì˜ ì¼ì •</h2>
            <div class="event"><span class="dot blue"></span> 10:00 ê°œë°œ ìŠ¤í”„ë¦°íŠ¸ íšŒì˜</div>
            <div class="event"><span class="dot purple"></span> 12:00 ë””ìì¸ ë¦¬ë·°</div>
            <div class="event"><span class="dot green"></span> 14:00 ì‹ ì…ì‚¬ì› ì˜¨ë³´ë”©</div>
        </div>

        <div class="activity">
            <h2>ìµœê·¼í™œë™</h2>
            <div class="log"><span class="badge">ìœ¤</span> ìœ¤í˜„ê¸°ë‹˜ì´ ìƒˆë¡œìš´ ë¯¸íŒ…ë£¸ì„ ì¡ì•˜ì–´ìš”</div>
            <div class="log"><span class="badge">ê¶Œ</span> ê¶Œì§€ì–¸ë‹˜ì´ ì¼ì •ì„ ìˆ˜ì •í–ˆì–´ìš”</div>
            <div class="log"><span class="badge">ì„</span> ì„í˜•íƒë‹˜ì´ ë¬¸ì„œë¥¼ ì—…ë¡œë“œí–ˆì–´ìš”</div>
        </div>
    </div>

    <div class="bottom-section">
        <div class="stats">
            <div class="stat-box"><div class="big">24</div><div>ìƒˆë¡œìš´ ì¼ì •</div></div>
            <div class="stat-box"><div class="big">8</div><div>ì™„ë£Œëœ ì¼ì •</div></div>
            <div class="stat-box"><div class="big">78</div><div>ì´ í™œë™ ì‹œê°„</div></div>
        </div>
        <div class="quote">
            ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ëŠ” ê¸°ìˆ ì´ ì•„ë‹ˆë¼<br>ì¸ì  ìì›ê³¼ í”„ë¡œì íŠ¸ ê´€ë¦¬ì˜ ë¬¸ì œë¡œ ì‹¤íŒ¨í•œë‹¤.<br>
            <b>- R. Thomsett</b>
        </div>
        <div class="today-user-events">
            <h3>ë‚˜ì˜ ì˜¤ëŠ˜ ì¼ì •</h3>
            <ul id="user-events-list">
                <li>ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
            </ul>
        </div>

        <div class="this-week-completed">
            <h3>ì´ë²ˆ ì£¼ ì™„ë£Œ ì¼ì •</h3>
            <p id="completed-this-week">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <div class="this-week-upcoming">
            <h3>ì´ë²ˆ ì£¼ ë‹¤ê°€ì˜¤ëŠ” ì¼ì •</h3>
            <p id="upcoming-this-week">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <div class="this-week-created">
            <h3>ì´ë²ˆ ì£¼ ìƒì„±ëœ ì¼ì •</h3>
            <p id="created-this-week">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <div id="usage-time-box">
            ì´ë²ˆ ì£¼ ëˆ„ì  ì‚¬ìš© ì‹œê°„: <span id="usage-time">ê³„ì‚° ì¤‘...</span>
        </div>

        <div class="workspace-members-box">
            <h3>ì°¸ì—¬ ì¤‘ì¸ ì‚¬ìš©ì</h3>
            <ul id="workspace-members" style="list-style: none; padding-left: 0;">
                <li>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
            </ul>
        </div>
    </div>

    <div class="mini-profile-container">
        <div class="mini-profile-summary">
            <img id="mini-profile-img" src="/images/default-profile.png" alt="ë‚´ í”„ë¡œí•„" />
            <div class="mini-profile-info">
                <div id="mini-profile-name">ì´ë¦„</div>
                <div id="mini-profile-role">ì—­í• </div>
            </div>

            <!-- âœ… ì ‘ì† ìƒíƒœ í‘œì‹œ (ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ê°’ìœ¼ë¡œ JSê°€ ë®ì–´ì”€) -->
            <div class="user-status-display" onclick="toggleStatusMenu()">ìƒíƒœ ë¡œë”©ì¤‘...</div>
        </div>

        <!-- âœ… ì ‘ì† ìƒíƒœ ë³€ê²½ ëª¨ë‹¬ (ìŠ¬ë¼ì´ë“œë¡œ ì—´ë¦¬ëŠ” ë°•ìŠ¤) -->
        <div class="status-modal" id="status-modal" style="display:none;">
            <ul>
                <li onclick="changeStatus('online')">ğŸŸ¢ ì˜¨ë¼ì¸</li>
                <li onclick="changeStatus('away')">ğŸŸ¡ ìë¦¬ë¹„ì›€</li>
                <li onclick="changeStatus('offline')">ğŸ”´ ì˜¤í”„ë¼ì¸</li>
            </ul>
        </div>

        <!-- âœ… ë¯¸ë‹ˆ ë©”ë‰´ (hover ì‹œ ì—´ë¦¬ëŠ” ë©”ë‰´) -->
        <div class="mini-profile-menu" style="display: none;">
            <ul>
                <li onclick="goToMyPage()">ë‚´ ì •ë³´</li>
                <li onclick="showStatus()">ì ‘ì† ìƒíƒœ</li>
                <li onclick="logout()">ë¡œê·¸ì•„ì›ƒ</li>
            </ul>
        </div>
    </div>

    <!-- âœ… ë‚´ ì •ë³´ ë³´ê¸° ëª¨ë‹¬ -->
    <div id="my-info-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('my-info-modal')">&times;</span>
            <button onclick="openEditModal()" style="position:absolute; top:15px; left:15px;">ìˆ˜ì •</button>
            <img id="my-img" src="" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" style="width:100px; border-radius:50%; margin-bottom:10px;">
            <h3 id="my-name"></h3>
            <p><strong>ì´ë©”ì¼:</strong> <span id="my-email"></span></p>
            <p><strong>ì „í™”ë²ˆí˜¸:</strong> <span id="my-phone"></span></p>
            <p><strong>ë¶€ì„œ:</strong> <span id="my-dept"></span></p>
            <p><strong>ì§ê¸‰:</strong> <span id="my-position"></span></p>
            <p><strong>ìƒíƒœ ë©”ì‹œì§€:</strong> <span id="my-status"></span></p>
        </div>
    </div>

    <!-- âœ… ë‚´ ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="edit-info-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('edit-info-modal')">&times;</span>
            <h3>ë‚´ ì •ë³´ ìˆ˜ì •</h3>

            <div class="form-group">
                <label for="edit-img">í”„ë¡œí•„ ì´ë¯¸ì§€</label>
                <input type="file" id="edit-img" accept="image/*" />
            </div>

            <div class="form-group">
                <label for="edit-nickname">ë‹‰ë„¤ì„</label>
                <input id="edit-nickname" placeholder="ë‹‰ë„¤ì„" />
            </div>

            <div class="form-group">
                <label for="edit-email">ì´ë©”ì¼</label>
                <input id="edit-email" placeholder="ì´ë©”ì¼" />
            </div>

            <div class="form-group">
                <label for="edit-phone">ì „í™”ë²ˆí˜¸</label>
                <input id="edit-phone" placeholder="ì „í™”ë²ˆí˜¸" />
            </div>

            <div class="form-group">
                <label for="edit-dept">ë¶€ì„œ</label>
                <select id="edit-dept">
                    <!-- JSì—ì„œ ë¶€ì„œ ì˜µì…˜ ë™ì  ì¶”ê°€ -->
                </select>
            </div>

            <div class="form-group">
                <label for="edit-position">ì§ê¸‰</label>
                <input id="edit-position" placeholder="ì§ê¸‰" />
            </div>

            <div class="form-group">
                <label for="edit-status">ìƒíƒœ ë©”ì‹œì§€</label>
                <input id="edit-status" placeholder="ìƒíƒœ ë©”ì‹œì§€" />
            </div>

            <button onclick="submitEdit()">ì €ì¥</button>
        </div>
    </div>



</div>

<script th:src="@{/js/wsmain.js}"></script>

<!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” (RNB) -->
<div id="rnbContainer"></div>
<script th:src="@{/js/rnb-fetch.js}"></script>


<!-- ì´ˆëŒ€ ëª¨ë‹¬ -->
<div th:replace="~{fragments/invite-modal :: inviteModalFragment}"></div>

<div th:replace="~{fragments/miniProfileFragment :: miniProfileFragment}"></div>

<!-- ì‚¬ìš©ì ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
<div id="user-detail-modal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <img id="detail-img" src="" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" style="width:100px; border-radius:50%; margin-bottom:10px;">
        <h3 id="detail-name"></h3>
        <p><strong>ì´ë©”ì¼:</strong> <span id="detail-email"></span></p>
        <p><strong>ì „í™”ë²ˆí˜¸:</strong> <span id="detail-phone"></span></p>
        <p><strong>ë¶€ì„œ:</strong> <span id="detail-dept"></span></p>
        <p><strong>ì§ê¸‰:</strong> <span id="detail-position"></span></p>
        <p><strong>ìƒíƒœ ë©”ì‹œì§€:</strong> <span id="detail-status"></span></p>
    </div>
</div>


<!-- RNB í† ê¸€ ë²„íŠ¼ìš© ìŠ¤í¬ë¦½íŠ¸ -->
<script th:src="@{/js/rnb-toggle.js}" defer></script>
<script th:src="@{/js/invite-modal.js}"></script>
<script th:src="@{/js/token.js}"></script>
<script th:inline="javascript">
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ë¶€ë¶„
    /*<![CDATA[*/
    const userId = /*[[${userId}]]*/ '';
    const userName = /*[[${userName}]]*/ '';
    const workspaceCd = /*[[${workspaceCd}]]*/ '';

    // âœ… localStorageì— ì €ì¥
    if (userId) {
        localStorage.setItem('userId', userId);
    }
    if (workspaceCd) {
        localStorage.setItem('workspaceCd', workspaceCd);
    }
    /*]]>*/

    function openSketchMeeting() {
        // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const user = {
            id: userId,    // ìœ„ì—ì„œ ì •ì˜í•œ ë³€ìˆ˜ ì‚¬ìš©
            name: userName  // ìœ„ì—ì„œ ì •ì˜í•œ ë³€ìˆ˜ ì‚¬ìš©
        };

        const workspaceCd = /*[[${workspaceCd}]]*/ '';

        // ë£¸ ID ìƒì„±
        const roomId = 'sketch-' + Date.now() + '-' + Math.random().toString(36).substr(2, 8);

        // ë¯¸ë””ì–´ ì„œë²„ URL
        const mediaServerUrl = /*[[${@environment.getProperty('media.server.url')}]]*/ 'https://localhost:3001';

        // URL íŒŒë¼ë¯¸í„° êµ¬ì„±
        const params = new URLSearchParams({
            roomId: roomId,
            workspaceId: workspaceCd,
            peerId: user.id,
            displayName: user.name,
            meetingType: 'sketch'
        });

        // ìƒˆ ì°½ì—ì„œ ì—´ê¸°
        const meetingUrl = `${mediaServerUrl}/ocean-video-chat-complete.html?${params}`;

        // íŒì—… ì°½ ì˜µì…˜
        const windowFeatures = 'width=1200,height=800,menubar=no,toolbar=no,location=no,status=no';
        const meetingWindow = window.open(meetingUrl, 'SketchMeeting', windowFeatures);

        if (!meetingWindow) {
            alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… ì°¨ë‹¨ì„ í•´ì œí•´ì£¼ì„¸ìš”.');
            // íŒì—…ì´ ì°¨ë‹¨ëœ ê²½ìš° í˜„ì¬ ì°½ì—ì„œ ì—´ê¸°
            window.location.href = meetingUrl;
        }
    }

    // ì´ˆëŒ€ ë§í¬ ìƒì„± í•¨ìˆ˜
    function getSketchMeetingInviteLink(roomId) {
        const baseUrl = window.location.origin;
        return `${baseUrl}/sketch/join?roomId=${roomId}`;
    }

    // ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ window ê°ì²´ì— ì €ì¥
    window.currentWorkspaceCd = workspaceCd;
</script>

</body>
</html>
