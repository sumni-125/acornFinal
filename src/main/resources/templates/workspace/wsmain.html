<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Ocean</title>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/lnb.css}" />
    <link rel="stylesheet" th:href="@{/css/wsmain.css}" />
    <link rel="stylesheet" th:href="@{/css/rnb.css}" />
    <link rel="stylesheet" th:href="@{/css/invite.css}" />
    <link rel="stylesheet" th:href="@{/css/profile-modal.css}" />

</head>

<body>
<!-- ì™¼ìª½ LNB -->
<div th:replace="~{fragments/lnb :: lnbFragment}"></div>

<div class="main-layout">
<!-- ë©”ì¸ ì½˜í…ì¸  -->
<div class="main">
    <div class="workspace-title" id="workspace-name" >ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„ ë¡œë”©ì¤‘...</div>
    <div class="divider-line"></div>
    <div class="top-banner">
        <div class="title">í”„ë¡œì íŠ¸ ë§ˆê° ( <span id="project_endDate"> </span> )ê¹Œì§€</div>
        <div class="d-day" id="top-banner-dday">D-21</div> <!-- ì´ ID í•„ìš” -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="date" id="top-banner-date">7ì›” 20ì¼ í† ìš”ì¼</div> <!-- ì´ ID í•„ìš” -->
    </div>




    <div class="main-section">
        <div class="schedule">
            <h2>ì˜¤ëŠ˜ì˜ ì¼ì •</h2>
            <ul id="user-events-list"><li>ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li></ul>
        </div>

        <div class="activity">
            <h2>ìµœê·¼í™œë™</h2>
            <div class="log">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>

    </div>

    <div class="bottom-section">
        <div class="weekly-stats">
            <h2>ì´ë²ˆ ì£¼ í†µê³„</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="big" id="created-this-week">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    <div class="label">ìƒˆë¡œìš´ ì¼ì •</div>
                </div>
                <div class="stat-box">
                    <div class="big" id="completed-this-week">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    <div class="label">ì™„ë£Œëœ ì¼ì •</div>
                </div>
                <div class="stat-box">
                    <div class="big" id="upcoming-this-week">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    <div class="label">ë‹¤ê°€ì˜¤ëŠ” í”„ë¡œì íŠ¸</div>
                </div>
                <div class="stat-box">
                    <div class="big" id="usage-time">ê³„ì‚° ì¤‘...</div>
                    <div class="label">ì´ í™œë™ ì‹œê°„</div>
                </div>
            </div>
        </div>

        <div class="quote">
            ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ëŠ” ê¸°ìˆ ì´ ì•„ë‹ˆë¼<br />
            ì¸ì  ìì›ê³¼ í”„ë¡œì íŠ¸ ê´€ë¦¬ì˜ ë¬¸ì œë¡œ ì‹¤íŒ¨í•œë‹¤.<br />
            <b>- R. Thomsett</b>
        </div>

    </div>



    <!--     ë¯¸ë‹ˆ í”„ë¡œí•„ ì˜ì—­ -->
<!--    <div class="mini-profile-container">-->
<!--        <div class="mini-profile-summary">-->
<!--            <img id="mini-profile-img" src="/images/profile.png" alt="ë‚´ í”„ë¡œí•„" />-->
<!--            <div class="mini-profile-info">-->
<!--                <div id="mini-profile-name">ì´ë¦„</div>-->
<!--                <div id="mini-profile-role">ì—­í• </div>-->
<!--            </div>-->
<!--            <div class="user-status-display" onclick="toggleStatusMenu()">ìƒíƒœ ë¡œë”©ì¤‘...</div>-->
<!--        </div>-->
<!--        <div class="status-modal" id="status-modal" style="display:none;">-->
<!--            <ul>-->
<!--                <li onclick="changeStatus('online')">ğŸŸ¢ ì˜¨ë¼ì¸</li>-->
<!--                <li onclick="changeStatus('away')">ğŸŸ¡ ìë¦¬ë¹„ì›€</li>-->
<!--                <li onclick="changeStatus('offline')">ğŸ”´ ì˜¤í”„ë¼ì¸</li>-->
<!--            </ul>-->
<!--        </div>-->
<!--        <div class="mini-profile-menu" style="display: none;">-->
<!--            <ul>-->
<!--                <li onclick="goToMyPage()">ë‚´ ì •ë³´</li>-->
<!--                <li onclick="showStatus()">ì ‘ì† ìƒíƒœ</li>-->
<!--                <li onclick="logout()">ë¡œê·¸ì•„ì›ƒ</li>-->
<!--            </ul>-->
<!--        </div>-->
<!--    </div>-->

<!--     ë‚´ ì •ë³´ ë³´ê¸°/ìˆ˜ì • ëª¨ë‹¬ ë° ì‚¬ìš©ì ìƒì„¸ ì •ë³´ ëª¨ë‹¬-->
<!--    <div id="my-info-modal" class="modal" style="display:none;">...</div>-->
<!--    <div id="edit-info-modal" class="modal" style="display:none;">...</div>-->
<!--    <div id="user-detail-modal" class="modal" style="display:none;">...</div>-->
<!--</div>-->

<!-- âœ… RNB fetch -->
</div>
<div id="rnbContainer" th:data-workspace-cd="${workspaceCd}"></div>
</div>
<!-- âœ… fetch ëŒ€ìƒ ëª¨ë‹¬ -->
<div id="profileModalContainer"></div>
<div id="inviteModalContainer"></div>


<!-- âœ… JS -->
<script th:src="@{/js/Token.js}" defer></script>
<script th:src="@{/js/wsmain.js}" defer></script>
<script th:src="@{/js/rnb-fetch.js}" defer></script>
<script th:src="@{/js/invite-modal.js}" defer></script>


<!-- âœ… ì‚¬ìš©ì ì •ë³´ Thymeleaf -> JS -->
<script th:inline="javascript">
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ë¶€ë¶„
    /*<![CDATA[*/
    const userId = /*[[${userId}]]*/ '';
    const userName = /*[[${userName}]]*/ '';

    // localStorageì— ì €ì¥ (í˜ì´ì§€ ë¡œë“œ ì‹œ)
    if (userId) {
        localStorage.setItem('userId', userId);
    }
    /*]]>*/

    function openSketchMeeting() {
    const workspaceCd = /*[[${workspaceCd}]]*/ '';

    // íšŒì˜ ì¤€ë¹„ í˜ì´ì§€ë¡œ ì´ë™
    window.location.href = `/meeting/setup?workspaceCd=${workspaceCd}`;
    }

    /* ì •ì ìœ¼ë¡œ í˜ì´ì§€ë¥¼ ë§Œë“¤ê³  ë¶ˆëŸ¬ì˜¤ëŠ”ê±°ë¼ í…ŒìŠ¤íŠ¸ìš© í•¨ìˆ˜(ì•ˆì¨ì„œ ì£¼ì„ì²˜ë¦¬)
    function openSketchMeeting() {
        // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const user = {
            id: userId,    // ìœ„ì—ì„œ ì •ì˜í•œ ë³€ìˆ˜ ì‚¬ìš©
            name: userName  // ìœ„ì—ì„œ ì •ì˜í•œ ë³€ìˆ˜ ì‚¬ìš©
        };

        const workspaceCd = /*[[${workspaceCd}]]*/ '';

        // ë£¸ ID ìƒì„±
        const roomId = 'sketch-' + Date.now() + '-' + Math.random().toString(36).substr(2, 8);

        // ë¯¸ë””ì–´ ì„œë²„ URL
        const mediaServerUrl = /*[[${@environment.getProperty('media.server.url')}]]*/ 'https://localhost:3001';

        // URL íŒŒë¼ë¯¸í„° êµ¬ì„±
        const params = new URLSearchParams({
            roomId: roomId,
            workspaceId: workspaceCd,
            peerId: user.id,
            displayName: user.name,
            meetingType: 'sketch'
        });

        // ìƒˆ ì°½ì—ì„œ ì—´ê¸°
        const meetingUrl = `${mediaServerUrl}/ocean-video-chat-complete.html?${params}`;

        // íŒì—… ì°½ ì˜µì…˜
        const windowFeatures = 'width=1200,height=800,menubar=no,toolbar=no,location=no,status=no';
        const meetingWindow = window.open(meetingUrl, 'SketchMeeting', windowFeatures);

        if (!meetingWindow) {
            alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… ì°¨ë‹¨ì„ í•´ì œí•´ì£¼ì„¸ìš”.');
            // íŒì—…ì´ ì°¨ë‹¨ëœ ê²½ìš° í˜„ì¬ ì°½ì—ì„œ ì—´ê¸°
            window.location.href = meetingUrl;
        }
    }
    */

    // ì´ˆëŒ€ ë§í¬ ìƒì„± í•¨ìˆ˜
    function getSketchMeetingInviteLink(roomId) {
        const baseUrl = window.location.origin;
        return `${baseUrl}/sketch/join?roomId=${roomId}`;
    }

    // ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ window ê°ì²´ì— ì €ì¥
    window.currentWorkspaceCd = workspaceCd;
</script>
</body>
</html>
