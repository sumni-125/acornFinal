<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>ê°œì¸ ìº˜ë¦°ë”</title>
    <link th:href="@{/css/lnb.css}" rel='stylesheet' />
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <style>
        /* ì „ì—­ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        :root {
            --bg-dark: #1A1A1A;
            --bg-medium: #2D2D2D;
            --text-light: #E0E0E0;
            --text-medium: #B0B0B0;
            --text-dark: #999;
            --accent-blue: #007bff;
            --border-color: #444;
            --input-bg: #3C3C3C;
        }

        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: flex;
            min-height: 100vh;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .app-container {
            display: flex;
            width: 100%;
        }

        /* ì¢Œì¸¡ ì‚¬ì´ë“œë°” */
        .sidebar-left {
            width: 250px;
            /* ì´ë¯¸ì§€ ê¸°ì¤€ ë„ˆë¹„ */
            background-color: var(--bg-medium);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .sidebar-left .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 40px;
            color: var(--accent-blue);
        }

        .sidebar-left nav ul {
            list-style: none;
            padding: 0;
            width: 100%;
        }

        .sidebar-left nav ul li {
            margin-bottom: 15px;
        }

        .sidebar-left nav ul li a {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-radius: 8px;
            color: var(--text-medium);
            text-decoration: none;
            font-size: 16px;
            transition: background-color 0.2s, color 0.2s;
        }

        .sidebar-left nav ul li a:hover,
        .sidebar-left nav ul li.active a {
            background-color: #444;
            color: var(--text-light);
        }

        .sidebar-left nav ul li a .icon {
            margin-right: 15px;
            font-size: 20px;
        }

        .sidebar-left .menu-toggle {
            margin-top: auto;
            /* í•˜ë‹¨ìœ¼ë¡œ ë°€ì–´ëƒ„ */
            padding: 10px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-medium);
            cursor: pointer;
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ (ìº˜ë¦°ë”) */
        .main-content {
            flex-grow: 1;
            padding: 30px;
            background-color: var(--bg-dark);
            display: flex;
            flex-direction: column;
        }

        /* ìš”ì¼ í—¤ë” (ì¼ìš”ì¼) í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ */
        .fc .fc-col-header-cell.fc-day-sun {
            /* ì¼ìš”ì¼ í—¤ë” */
            color: #FF6B6B;
            /* ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½ (ì•½ê°„ ë¶€ë“œëŸ¬ìš´ ë¹¨ê°•) */
        }

        /* ì¼ìš”ì¼ ë‚ ì§œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ */
        .fc .fc-daygrid-day.fc-day-sun .fc-daygrid-day-number {
            color: #FF6B6B;
            /* ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        }

        .fc .fc-daygrid-day {
            border: 1px solid var(--border-color);
            background-color: var(--bg-medium);
            transition: background-color 0.2s ease-in-out;
            /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ ì¶”ê°€ */
        }

        .fc .fc-daygrid-day:hover {
            background-color: #4A4A4A;
            /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ë” ì§„í•œ ë°°ê²½ìƒ‰ */
            cursor: pointer;
        }

        .fc .fc-daygrid-day-number {
            color: var(--text-light);
            font-size: 16px;
            padding: 8px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .calendar-header .nav-arrows button {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 28px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .calendar-header .nav-arrows button:hover {
            color: var(--accent-blue);
        }

        .calendar-header .current-month {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-light);
        }

        #calendar {
            background-color: var(--bg-medium);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            flex-grow: 1;
            /* ë‚¨ì€ ê³µê°„ì„ ì±„ìš°ë„ë¡ */
        }

        /* FullCalendar ì˜¤ë²„ë¼ì´ë“œ ìŠ¤íƒ€ì¼ */
        .fc .fc-toolbar-title {
            color: var(--text-light);
        }

        .fc .fc-button {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-light);
        }

        .fc .fc-button:hover {
            background-color: #555;
            color: #FFF;
        }

        .fc .fc-col-header-cell {
            background-color: #3C3C3C;
            color: var(--text-medium);
            font-weight: 600;
            padding: 10px 0;
            border: 1px solid var(--border-color);
        }

        .fc .fc-daygrid-day {
            border: 1px solid var(--border-color);
            background-color: var(--bg-medium);
        }

        .fc .fc-daygrid-day-number {
            color: var(--text-light);
            font-size: 16px;
            padding: 8px;
        }

        .fc .fc-day-today {
            background-color: #3A3A3A !important;
            /* ì˜¤ëŠ˜ ë‚ ì§œ ë°°ê²½ */
        }

        .fc .fc-event {
            background-color: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 2px 5px;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .fc-daygrid-day-top {
            display: flex;
            justify-content: flex-end;
            /* ë‚ ì§œ ìˆ«ì ì˜¤ë¥¸ìª½ ì •ë ¬ */
            padding: 5px;
        }

        .fc-daygrid-event-harness {
            margin-top: 2px;
        }

        /* ìš°ì¸¡ ì‚¬ì´ë“œë°” */
        .sidebar-right {
            width: 280px;
            /* ì´ë¯¸ì§€ ê¸°ì¤€ ë„ˆë¹„ */
            background-color: var(--bg-medium);
            padding: 20px;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3);
        }

        .sidebar-right .profile-card {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            background-color: var(--input-bg);
            padding: 15px;
            border-radius: 10px;
        }

        .sidebar-right .profile-card img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            border: 2px solid var(--accent-blue);
        }

        .sidebar-right .profile-card .details {
            flex-grow: 1;
        }

        .sidebar-right .profile-card .details .name {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-light);
        }

        .sidebar-right .profile-card .details .role {
            font-size: 14px;
            color: var(--text-medium);
        }

        .sidebar-right .progress-bar-container {
            width: 100%;
            background-color: #444;
            border-radius: 5px;
            height: 8px;
            margin-top: 8px;
        }

        .sidebar-right .progress-bar {
            height: 100%;
            width: 33%;
            /* ì˜ˆì‹œ: 33% */
            background-color: var(--accent-blue);
            border-radius: 5px;
        }

        .sidebar-right h3 {
            font-size: 18px;
            color: var(--text-light);
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .sidebar-right .member-list {
            list-style: none;
            padding: 0;
        }

        .sidebar-right .member-list li {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .sidebar-right .member-list li img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            border: 1px solid #555;
        }

        .sidebar-right .member-list li .member-name {
            font-size: 16px;
            color: var(--text-light);
            flex-grow: 1;
        }

        .sidebar-right .member-list li .member-role {
            font-size: 13px;
            color: var(--text-medium);
        }

        .sidebar-right .invite-member {
            display: flex;
            align-items: center;
            background-color: var(--input-bg);
            padding: 10px 15px;
            border-radius: 10px;
            margin-top: 30px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .sidebar-right .invite-member:hover {
            background-color: #555;
        }

        .sidebar-right .invite-member .icon {
            font-size: 20px;
            margin-right: 10px;
            color: var(--accent-blue);
        }

        .sidebar-right .invite-member span {
            font-size: 16px;
            color: var(--text-light);
        }

        /* í°íŠ¸ì–´ì¸ ëŒ€ì²´ ì•„ì´ì½˜ */
        .icon-home::before {
            content: 'ğŸ ';
        }

        .icon-team-calendar::before {
            content: 'ğŸ—“ï¸';
        }

        .icon-personal-calendar::before {
            content: 'ğŸ‘¤';
        }

        .icon-meeting-place::before {
            content: 'ğŸ“';
        }

        .icon-sketch-meeting::before {
            content: 'âœï¸';
        }

        .icon-menu::before {
            content: 'â˜°';
        }

        .icon-arrow-left::before {
            content: '<';
        }

        .icon-arrow-right::before {
            content: '>';
        }

        .icon-add-user::before {
            content: 'â•';
        }

        /* ëª¨ë‹¬ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            display: none;
            /* ê¸°ë³¸ ìˆ¨ê¹€ */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            /* ì–´ë‘ìš´ ì˜¤ë²„ë ˆì´ */
            z-index: 1000;
            /* ìº˜ë¦°ë”ë³´ë‹¤ ìœ„ì— */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--bg-medium);
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-light);
            margin: 0;
        }

        .modal-close-button {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--text-medium);
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            transition: color 0.2s;
        }

        .modal-close-button:hover {
            color: var(--text-light);
        }

        /* add-event.html ì—ì„œ ê°€ì ¸ì˜¨ í¼ í•„ë“œ ìŠ¤íƒ€ì¼ (createEventModalì— ì ìš©) */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-medium);
        }

        .modal-content input[type="text"],
        .modal-content input[type="datetime-local"],
        .modal-content textarea,
        .modal-content select,
        .modal-content input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg);
            color: var(--text-light);
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .modal-content input[type="text"]:focus,
        .modal-content input[type="datetime-local"]:focus,
        .modal-content textarea:focus,
        .modal-content select:focus,
        .modal-content input[type="number"]:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
            outline: none;
        }

        .modal-content textarea {
            resize: vertical;
            min-height: 80px;
        }

        .modal-content .flex-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-content .datetime-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-content .datetime-group input {
            flex-grow: 1;
        }

        .modal-content .datetime-group span {
            color: var(--text-medium);
        }

        .modal-content .checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .modal-content .checkbox-container input[type="checkbox"] {
            margin-right: 8px;
            width: auto;
            accent-color: var(--accent-blue);
        }

        .modal-content .checkbox-container label {
            margin-bottom: 0;
            font-weight: normal;
        }

        .modal-content .file-input-container {
            position: relative;
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg);
            padding: 8px 12px;
            cursor: pointer;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .modal-content .file-input-container:hover {
            border-color: var(--accent-blue);
        }

        .modal-content .file-input-container input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .modal-content .file-input-container .icon {
            margin-right: 10px;
            color: var(--text-medium);
            font-size: 18px;
        }

        .modal-content .file-input-container span {
            color: var(--text-light);
            font-size: 16px;
        }

        .modal-content .map-placeholder {
            border: 1px dashed #555;
            height: 120px;
            /* ëª¨ë‹¬ ì•ˆì—ì„œ ì§€ë„ ë†’ì´ ì¡°ì • */
            background-color: var(--input-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-dark);
            margin-top: 10px;
            border-radius: 8px;
            font-size: 14px;
        }

        .modal-content .submit-button-wrapper {
            text-align: right;
            margin-top: 30px;
        }

        .modal-content button[type="submit"],
        .modal-content .modal-footer button {
            background-color: var(--accent-blue);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .modal-content button[type="submit"]:hover,
        .modal-content .modal-footer button:hover {
            background-color: #0056b3;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }

        .modal-content button[type="button"].cancel-button {
            background-color: #555;
            margin-left: 10px;
        }

        .modal-content button[type="button"].cancel-button:hover {
            background-color: #777;
        }

        /* ìƒ‰ìƒ í”¼ì»¤ ì»¤ìŠ¤í„°ë§ˆì´ì§• */
        .modal-content input[type="color"] {
            width: 40px;
            height: 40px;
            padding: 0;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }

        .modal-content input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .modal-content input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 50%;
        }

        /* select ë°•ìŠ¤ í™”ì‚´í‘œ ì»¤ìŠ¤í„°ë§ˆì´ì§• */
        .modal-content select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23E0E0E0" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }

        /* ëª¨ë‹¬ ë‚´ ì•„ì´ì½˜ì„ ìœ„í•œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .modal-content .icon-clock::before {
            content: 'â±ï¸';
            margin-right: 5px;
        }

        .modal-content .icon-description::before {
            content: 'ğŸ“';
        }

        .modal-content .icon-attach::before {
            content: 'ğŸ“';
        }

        .modal-content .icon-bell::before {
            content: 'ğŸ””';
        }

        .modal-content .icon-location::before {
            content: 'ğŸ“';
        }

        .modal-content .icon-priority::before {
            content: 'â­';
        }

        /* ===== ì¼ì • ìƒì„¸ ëª¨ë‹¬ (eventDetailModal) ===== */
        #eventDetailModal .modal-content {
            max-width: 450px;
            /* ìƒì„¸ ëª¨ë‹¬ì€ ì¡°ê¸ˆ ë” ì‘ê²Œ */
        }

        #eventDetailModal .header-actions {
            margin-bottom: 15px;
            /* í—¤ë” ì•¡ì…˜ê³¼ ì œëª© ì‚¬ì´ ê°„ê²© */
        }

        #eventDetailModal .title-section {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        #eventDetailModal .title-section .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 12px;
            flex-shrink: 0;
        }

        #eventDetailModal .title-section .main-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-light);
        }

        #eventDetailModal .info-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        #eventDetailModal .info-item .icon {
            font-size: 20px;
            margin-right: 15px;
            color: var(--text-medium);
            flex-shrink: 0;
        }

        #eventDetailModal .info-item .value {
            font-size: 16px;
            color: var(--text-light);
            white-space: pre-wrap;
            flex-grow: 1;
        }

        #eventDetailModal .info-item.description .value {
            background-color: var(--input-bg);
            border-radius: 8px;
            padding: 12px;
            min-height: 80px;
            width: 100%;
        }

        #eventDetailModal .attachments-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        #eventDetailModal .attachments-list li {
            background-color: var(--input-bg);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 15px;
        }

        #eventDetailModal .attachments-list li a {
            color: var(--accent-blue);
            text-decoration: none;
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        #eventDetailModal .attachments-list li .file-icon {
            margin-right: 10px;
            color: var(--text-medium);
            font-size: 18px;
        }

        #eventDetailModal .modal-footer {
            text-align: right;
            margin-top: 20px;
        }

        /* ì•„ì´ì½˜ */
        .icon-edit::before {
            content: 'âœï¸';
        }

        .icon-delete::before {
            content: 'ğŸ—‘ï¸';
        }

        .icon-close::before {
            content: 'âœ•';
        }

        .icon-calendar-day::before {
            content: 'ğŸ—“ï¸';
        }

        .icon-user-detail::before {
            content: 'ğŸ‘¤';
        }

        .icon-location-detail::before {
            content: 'ğŸ“';
        }

        .icon-description-detail::before {
            content: 'ğŸ’¬';
        }

        .icon-bell-detail::before {
            content: 'ğŸ””';
        }

        .icon-attachment-detail::before {
            content: 'ğŸ“';
        }

        .icon-file-doc::before {
            content: 'ğŸ“„';
        }

        .icon-download::before {
            content: 'â¬‡ï¸';
        }

        /* ===== ì¼ì • ìˆ˜ì • ëª¨ë‹¬ (updateEventModal) ===== */
        #updateEventModal .modal-content {
            max-width: 500px;
        }

        #updateEventModal .file-delete-button {
            background-color: #dc3545;
            /* ë¹¨ê°„ìƒ‰ ì‚­ì œ ë²„íŠ¼ */
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            transition: background-color 0.2s;
        }

        #updateEventModal .file-delete-button:hover {
            background-color: #c82333;
        }

        #updateEventModal .current-files-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--input-bg);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 8px;
            font-size: 15px;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <div class="sidebar-left">
            <nav>
                <nav th:replace="lnb :: lnbFragment"></nav>
            </nav>
        </div>

        <div class="main-content">
            <div class="calendar-header">
                <div class="nav-arrows">
                    <button id="prevMonthBtn" class="icon-arrow-left"></button>
                    <span id="currentMonthText" class="current-month">6 JUN 2025</span>
                    <button id="nextMonthBtn" class="icon-arrow-right"></button>
                </div>
            </div>
            <div id='calendar'></div>
        </div>

        <div class="sidebar-right">

        </div>
    </div>

    <div id="createEventModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ìƒˆ ì¼ì • ì¶”ê°€</h3>
                <button type="button" class="modal-close-button" onclick="closeCreateEventModal()">&times;</button>
            </div>
            <form id="eventForm" onsubmit="event.preventDefault(); saveEvent();">
                <div class="form-group flex-container">
                    <input type="text" id="title" name="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    <input type="color" id="color" name="color" value="#0066CC">
                </div>

                <div class="form-group">
                    <label class="icon-clock">ì¼ì‹œ</label>
                    <div class="datetime-group">
                        <input type="datetime-local" id="startDatetime" name="startDatetime" required>
                        <span>&mdash;</span>
                        <input type="datetime-local" id="endDatetime" name="endDatetime" required>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="allDay" name="allDay">
                        <label for="allDay">ì¢…ì¼</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="icon-user-detail">ì°¸ê°€ì ì„ íƒ</label>
                    <div class="checkbox-container" id="workspaceMembers">
                        
                    </div>
                </div>

                <div class="form-group">
                    <label for="description" class="icon-description">ì„¤ëª… ì¶”ê°€</label>
                    <textarea id="description" name="description" rows="4" placeholder="ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
                </div>


                <div class="form-group">
                    <div class="file-input-container">
                        <span class="icon icon-attach"></span>
                        <span>ì²¨ë¶€íŒŒì¼ ì¶”ê°€</span>
                        <input type="file" id="fileUpload" name="files" multiple>
                    </div>
                    <ul id="insertedFiles" style="list-style: none; padding: 0; margin-top: 10px;"></ul>
                </div>

                <div class="form-group">
                    <label for="notification" class="icon-bell">ì•Œë¦¼ ì‹œê°„</label>
                    <select id="notification" name="notification" required>
                        <option value="0">ì•Œë¦¼ ì—†ìŒ</option>
                        <option value="1440">ì „ë‚  ì˜¤ì „ 9ì‹œ</option>
                        <option value="540">ë‹¹ì¼ ì˜¤ì „ 9ì‹œ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="location" class="icon-location">ìœ„ì¹˜ ì¶”ê°€</label>
                    <input type="text" id="location" name="location" placeholder="ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì§€ë„ì—ì„œ ì„ íƒí•˜ì„¸ìš”.">
                    <div class="map-placeholder">
                        <p>ì§€ë„ APIê°€ í‘œì‹œë  ê³µê°„</p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="priority" class="icon-priority">ì¤‘ìš”ë„</label>
                    <select id="priority" name="priority" required>
                        <option value="LOW">ë‚®ìŒ</option>
                        <option value="NORMAL" selected>ë³´í†µ</option>
                        <option value="HIGH">ë†’ìŒ</option>
                    </select>
                </div>

                <div class="form-group">
                    <div class="checkbox-container">
                        <input type="checkbox" id="isShared" name="isShared">
                        <label for="isShared">ê³µìœ </label>
                    </div>
                </div>

                <div class="submit-button-wrapper">
                    <button type="submit">ë“±ë¡í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>

    <div id="eventDetailModal" class="modal-overlay">
        <div class="modal-content">
            <div class="header-actions">
                <button type="button" class="edit-button" title="ìˆ˜ì •" style="display:none;" onclick="openUpdateModal()">
                    <span class="icon icon-edit"></span>
                </button>
                <button type="button" class="delete-button" title="ì‚­ì œ" style="display:none;" onclick="deleteEvent()">
                    <span class="icon icon-delete"></span>
                </button>
                <button type="button" class="modal-close-button" onclick="closeDetailModal()">
                    <span class="icon icon-close"></span>
                </button>
            </div>

            <div class="title-section">
                <div class="color-dot" th:style="'background-color:' + ${event?.color}"></div>
                <div class="text-content">
                    <div class="main-title" id="detailTitle" th:text="${event?.title}">ì œëª© ì—†ìŒ</div>
                    <div class="sub-text">
                        <span
                            th:if="${event?.startDatetime != null and event?.endDatetime != null and #temporals.format(event.startDatetime, 'yyyyMMdd') == #temporals.format(event.endDatetime, 'yyyyMMdd') and #temporals.format(event.startDatetime, 'HHmm') == '0000' and #temporals.format(event.endDatetime, 'HHmm') == '2359'}">
                            <span th:text="${#temporals.format(event.startDatetime, 'Mì›” dì¼ (E)')} + ' ì¢…ì¼'"></span>
                        </span>
                        <span
                            th:unless="${event?.startDatetime == null or event?.endDatetime == null or (#temporals.format(event.startDatetime, 'yyyyMMdd') == #temporals.format(event.endDatetime, 'yyyyMMdd') and #temporals.format(event.startDatetime, 'HHmm') == '0000' and #temporals.format(event.endDatetime, 'HHmm') == '2359')}">
                            <span
                                th:text="${event?.startDatetime != null ? #temporals.format(event.startDatetime, 'Mì›” dì¼ (E) a h:mm') : 'ì‹œì‘ì¼ ì—†ìŒ'}"></span>
                            <span> - </span>
                            <span
                                th:text="${event?.endDatetime != null ? #temporals.format(event.endDatetime, 'Mì›” dì¼ (E) a h:mm') : 'ì¢…ë£Œì¼ ì—†ìŒ'}"></span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="info-item">
                <span class="icon icon-user-detail"></span>
                <div class="value" id="detailAuthor"></div>
            </div>

            <div class="info-item">
                <span class="icon icon-location-detail"></span>
                <div class="value" id="detailLocation"></div>
            </div>

            <div class="info-item description">
                <span class="icon icon-description-detail"></span>
                <div class="value" id="detailDescriptionDisplay"></div>
            </div>

            <div class="info-item">
                <span class="icon icon-bell-detail"></span>
                <div class="value" id="detailNotification"></div>
            </div>

            <div class="info-item">
                <span class="icon icon-attachment-detail"></span>
                <div class="value">
                    <ul id="detailFiles" class="attachments-list"></ul>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" onclick="closeDetailModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <div id="updateEventModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì¼ì • ìˆ˜ì •</h3>
                <button type="button" class="modal-close-button" onclick="closeUpdateModal()">&times;</button>
            </div>
            <form id="updateEventForm">
                <input type="hidden" id="update-eventCd" name="eventCd" />

                <div class="form-group flex-container">
                    <input type="text" id="update-title" name="title" placeholder="ì œëª©" required>
                    <input type="color" id="update-color" name="color" value="#0066CC">
                </div>

                <div class="form-group">
                    <label class="icon-clock">ì‹œì‘ ì¼ì‹œ</label>
                    <input type="datetime-local" id="update-startDatetime" name="startDatetime" required>
                </div>

                <div class="form-group">
                    <label class="icon-clock">ì¢…ë£Œ ì¼ì‹œ</label>
                    <input type="datetime-local" id="update-endDatetime" name="endDatetime" required>
                </div>

                <div class="form-group">
                    <label for="update-description" class="icon-description">ì„¤ëª…</label>
                    <textarea id="update-description" name="description" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label class="icon-attach">ê¸°ì¡´ íŒŒì¼</label>
                    <ul id="updateFiles" class="current-files-list"></ul>
                    <label class="icon-attach" style="margin-top: 15px;">ìƒˆ íŒŒì¼ ì²¨ë¶€:</label>
                    <input type="file" id="update-fileUpload" name="files" multiple>
                </div>

                <div class="form-group">
                    <label for="update-notification" class="icon-bell">ì•Œë¦¼</label>
                    <select id="update-notification" name="notification">
                        <option value="1440">ì „ë‚  ì˜¤ì „ 9ì‹œ</option>
                        <option value="540">ë‹¹ì¼ ì˜¤ì „ 9ì‹œ</option>
                        <option value="0">ì•Œë¦¼ ì—†ìŒ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="update-location" class="icon-location">ìœ„ì¹˜</label>
                    <input type="text" id="update-location" name="location" placeholder="ìœ„ì¹˜">
                </div>

                <div class="form-group">
                    <label for="update-priority" class="icon-priority">ìš°ì„ ìˆœìœ„</label>
                    <select id="update-priority" name="priority">
                        <option value="LOW">ë‚®ìŒ</option>
                        <option value="NORMAL">ë³´í†µ</option>
                        <option value="HIGH">ë†’ìŒ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="update-progressStatus">ì§„í–‰ ìƒíƒœ</label>
                    <select id="update-progressStatus" name="progressStatus">
                        <option value="TODO">ì˜ˆì •</option>
                        <option value="IN_PROGRESS">ì§„í–‰ì¤‘</option>
                        <option value="DONE">ì™„ë£Œ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="update-isShared">ê³µìœ  ì—¬ë¶€</label>
                    <select id="update-isShared" name="isShared">
                        <option value="0">ë¹„ê³µìœ </option>
                        <option value="1">ê³µìœ </option>
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" onclick="submitUpdateEvent()">ìˆ˜ì •í•˜ê¸°</button>
                    <button type="button" class="cancel-button" onclick="closeUpdateModal()">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>


    <script th:inline="javascript">
        /*<![CDATA[*/
        // í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ì IDëŠ” ë°±ì—”ë“œì—ì„œ ì£¼ì…ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. (ë”ë¯¸ê°’)
        const currentUserId = '102049037194510417221'; // ì‹¤ì œë¡œëŠ” Thymeleaf ëª¨ë¸ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨: [[${currentUserId}]]

        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                height: 'auto', // ìº˜ë¦°ë” ë†’ì´ ìë™ ì¡°ì ˆ
                initialDate: '2025-06-01', // ì´ë¯¸ì§€ì— ë§ì¶° 2025ë…„ 6ì›”ë¡œ ì´ˆê¸° ë‚ ì§œ ì„¤ì •
                // ë‚ ì§œ í´ë¦­ì‹œ : ì¼ì • ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ (createEventModal ë„ì›€)
                dateClick: async function (info) {
                    closeDetailModal(); // í˜¹ì‹œ ì—´ë ¤ìˆëŠ” ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
                    closeUpdateModal(); // í˜¹ì‹œ ì—´ë ¤ìˆëŠ” ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°

                    document.getElementById('eventForm').reset(); // í¼ ì´ˆê¸°í™”
                    // í´ë¦­ëœ ë‚ ì§œë¡œ ì‹œì‘/ì¢…ë£Œ ì¼ì‹œ ê¸°ë³¸ê°’ ì„¤ì •
                    document.getElementById('startDatetime').value = info.dateStr + 'T09:00';
                    document.getElementById('endDatetime').value = info.dateStr + 'T18:00';
                    document.getElementById('insertedFiles').innerHTML = ''; // íŒŒì¼ ëª©ë¡ ì´ˆê¸°í™”

                    const workspaceCd = '61e37b28-b4d9-4939-951d-52716ca9b89b';
                    fetch(`/api/getMembers?workspaceCd=${workspaceCd}`)
                        .then(res => {
                            if (!res.ok) throw new Error("ë©¤ë²„ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨");
                            return res.json();
                        })
                        .then(data => {
                            const membersData = data;
                            const container = document.getElementById('workspaceMembers');

                            for (let i = 0; i < membersData.length; i++) {
                                const member = membersData[i];

                                const checkbox = document.createElement('input');
                                checkbox.type = 'checkbox';

                                checkbox.name = 'attendenceIds';

                                const uniqueId = 'userId' + member.userId;
                                checkbox.id = uniqueId;
                                checkbox.value = member.userId;

                                const label = document.createElement('label');
                                label.htmlFor = uniqueId; // idë‘ ì—°ê²°
                                label.textContent = member.userNickname;

                                container.appendChild(checkbox);
                                container.appendChild(label);
                                container.appendChild(document.createElement('br'));
                            }

                        });
                    document.getElementById('createEventModal').style.display = 'flex'; // ëª¨ë‹¬ í‘œì‹œ
                },
                // ê°œì¸ì¼ì • ë¦¬ìŠ¤íŠ¸ í’€ìº˜ë¦°ë”ì— ë¿Œë ¤ì£¼ëŠ” ë¶€ë¶„
                events: function (fetchInfo, successCallback, failureCallback) {
                    // userIdëŠ” currentUserIdë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ë°±ì—”ë“œì—ì„œ ì¸ì¦ ì •ë³´ë¡œ ìë™ ì²˜ë¦¬
                    fetch(`/api/calendar/personal?userId=${currentUserId}`)
                        .then(response => {
                            if (!response.ok) throw new Error("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨!");
                            return response.json();
                        })
                        .then(data => {
                            const events = data.map(item => ({
                                id: item.eventCd,
                                title: item.title,
                                start: item.startDatetime,
                                end: item.endDatetime,
                                color: item.color
                            }));
                            successCallback(events);
                        })
                        .catch(err => {
                            console.error(err);
                            failureCallback(err);
                        });
                },
                // ì¼ì • í´ë¦­ ì´ë²¤íŠ¸ : ì¼ì • ìƒì„¸ ëª¨ë‹¬ì°½ ë„ì›€
                eventClick: function (info) {
                    closeCreateEventModal(); // í˜¹ì‹œ ì—´ë ¤ìˆëŠ” ìƒì„± ëª¨ë‹¬ ë‹«ê¸°
                    closeUpdateModal(); // í˜¹ì‹œ ì—´ë ¤ìˆëŠ” ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°

                    const eventCd = info.event.id;
                    fetch(`/api/calendar/personal/events/${eventCd}`)
                        .then(res => {
                            if (!res.ok) throw new Error("ìƒì„¸ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨");
                            return res.json();
                        })
                        .then(data => {
                            // ìƒì„¸ ëª¨ë‹¬ì— ë°ì´í„° ì±„ìš°ê¸°
                            const event = data.event;

                            console.log("event", event);
                            console.log("currentUserId", currentUserId);

                            document.getElementById('detailTitle').innerText = event.title || 'ì œëª© ì—†ìŒ';
                            document.getElementById('detailAuthor').innerText = event.userName || event.userId || 'ì•Œ ìˆ˜ ì—†ìŒ';
                            document.getElementById('detailLocation').innerText = data.location || 'ìœ„ì¹˜ ì •ë³´ ì—†ìŒ';
                            document.getElementById('detailDescriptionDisplay').innerText = event.description || 'ì„¤ëª… ì—†ìŒ';

                            // ì•Œë¦¼ ì‹œê°„ í¬ë§·íŒ…
                            const notifyTimeMinutes = event.notifyTime; // ê°€ì •: notifyTimeì€ ë¶„ ë‹¨ìœ„ ìˆ«ì
                            let notificationText = 'ì•Œë¦¼ ì—†ìŒ';
                            if (notifyTimeMinutes > 0) {
                                if (notifyTimeMinutes === 1440) notificationText = 'ì „ë‚  9ì‹œ';
                                else if (notifyTimeMinutes === 540) notificationText = 'ë‹¹ì¼ 9ì‹œ';
                            }
                            document.getElementById('detailNotification').innerText = notificationText;

                            // ë‚ ì§œ ë° ì‹œê°„ í¬ë§·íŒ… (FullCalendar ë‚ ì§œ í˜•ì‹ì— ë”°ë¼ ì¡°ì •)
                            // ISO ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜í•˜ì—¬ í¬ë§·íŒ…
                            const startDateTime = event.startDatetime ? new Date(event.startDatetime) : null;
                            const endDateTime = event.endDatetime ? new Date(event.endDatetime) : null;

                            let dateTimeDisplay = '';
                            if (startDateTime && endDateTime) {
                                const startDateFormatted = formatDate(startDateTime, 'Mì›” dì¼ (E)');
                                const startTimeFormatted = formatDate(startDateTime, 'a h:mm');
                                const endDateFormatted = formatDate(endDateTime, 'Mì›” dì¼ (E)');
                                const endTimeFormatted = formatDate(endDateTime, 'a h:mm');

                                // ì¢…ì¼ ì´ë²¤íŠ¸ í™•ì¸ (00:00 - 23:59:59)
                                const isAllDay = startDateTime.getHours() === 0 && startDateTime.getMinutes() === 0 &&
                                    endDateTime.getHours() === 23 && endDateTime.getMinutes() === 59; // ì´ˆ, ë°€ë¦¬ì´ˆëŠ” ë¬´ì‹œ

                                if (isAllDay && startDateFormatted === formatDate(endDateTime, 'Mì›” dì¼ (E)')) {
                                    dateTimeDisplay = `${startDateFormatted} ì¢…ì¼`;
                                } else {
                                    dateTimeDisplay = `${startDateFormatted} ${startTimeFormatted} - ${endDateFormatted} ${endTimeFormatted}`;
                                }
                            } else {
                                dateTimeDisplay = 'ì¼ì‹œ ì •ë³´ ì—†ìŒ';
                            }
                            document.querySelector('#eventDetailModal .sub-text').innerText = dateTimeDisplay;


                            // ì´ë²¤íŠ¸ ìƒ‰ìƒ í‘œì‹œ ì—…ë°ì´íŠ¸
                            document.querySelector('#eventDetailModal .color-dot').style.backgroundColor = event.color || '#007bff';

                            // ì²¨ë¶€íŒŒì¼ ëª©ë¡
                            const detailFilesUl = document.getElementById('detailFiles');
                            detailFilesUl.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
                            if (data.fileList && data.fileList.length > 0) {
                                data.fileList.forEach(file => {
                                    const li = document.createElement('li');
                                    li.innerHTML = `
                                  <a href="/api/calendar/personal/events/${eventCd}/files?fileId=${file.fileId}" target="_blank">
                                      <span class="file-icon icon-file-doc"></span>
                                      <span>${file.fileNm}</span>
                                  </a>
                                  <a href="/api/calendar/personal/events/${eventCd}/files?fileId=${file.fileId}" title="ë‹¤ìš´ë¡œë“œ" class="download-icon">
                                      â¬‡ï¸
                                  </a>
                              `;
                                    detailFilesUl.appendChild(li);
                                });
                            } else {
                                const li = document.createElement('li');
                                li.innerText = 'ì²¨ë¶€íŒŒì¼ ì—†ìŒ';
                                detailFilesUl.appendChild(li);
                            }

                            // ì‘ì„±ì ë³¸ì¸ì¸ ê²½ìš°ì—ë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ë³´ì´ê¸°
                            // currentUserIdëŠ” ìœ„ì—ì„œ ì •ì˜ëœ ì „ì—­ë³€ìˆ˜
                            const detailButtonsContainer = document.querySelector('#eventDetailModal .header-actions');
                            const editBtn = detailButtonsContainer.querySelector('.edit-button');
                            const deleteBtn = detailButtonsContainer.querySelector('.delete-button');

                            if (event.userId === currentUserId) {
                                if (editBtn) editBtn.style.display = 'block';
                                if (deleteBtn) deleteBtn.style.display = 'block';
                            } else {
                                if (editBtn) editBtn.style.display = 'none';
                                if (deleteBtn) deleteBtn.style.display = 'none';
                            }

                            // ìˆ˜ì • ëª¨ë‹¬ ë„ìš¸ ë•Œ ì´ ì •ë³´ í™œìš©í•  ìˆ˜ ìˆê²Œ ì „ì—­ ë³€ìˆ˜ ì €ì¥
                            window.selectedEventData = data;
                            document.getElementById('eventDetailModal').style.display = 'flex'; // ëª¨ë‹¬ í‘œì‹œ
                        })
                        .catch(err => {
                            console.error(err);
                            alert("ì¼ì • ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                        });
                }
            });

            calendar.render();

            // ì´ì „/ë‹¤ìŒ ì›” ì´ë™ ë²„íŠ¼ ì—°ê²°
            document.getElementById('prevMonthBtn').addEventListener('click', function () {
                calendar.prev();
                updateMonthText(calendar);
            });
            document.getElementById('nextMonthBtn').addEventListener('click', function () {
                calendar.next();
                updateMonthText(calendar);
            });
            // ì´ˆê¸° ì›” í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateMonthText(calendar);
            function updateMonthText(cal) {
                const currentDate = cal.getDate();
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth() + 1;
                document.getElementById('currentMonthText').innerText = `${year}ë…„ ${month}ì›”`;
            }

            // FullCalendar headerToolbar ë²„íŠ¼ì„ ìˆ¨ê¸°ê³  ì»¤ìŠ¤í…€ ë²„íŠ¼ ì‚¬ìš©
            calendar.setOption('headerToolbar', {
                left: '', // ê¸°ë³¸ prev, next, today ë²„íŠ¼ ìˆ¨ê¹€
                center: '', // ê¸°ë³¸ íƒ€ì´í‹€ ìˆ¨ê¹€
                right: '' // ê¸°ë³¸ view ë²„íŠ¼ ìˆ¨ê¹€
            });
        });

        // Date ê°ì²´ë¥¼ ì›í•˜ëŠ” í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ í¬ë§·í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function formatDate(date, format) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
            let hours24 = date.getHours();
            let hours12 = hours24 % 12;
            hours12 = hours12 ? hours12 : 12;
            const minutes = date.getMinutes();
            const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
            const ampm = hours24 >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';

            return format
                .replace('yyyy', year)
                .replace('M', month)
                .replace('d', day)
                .replace('E', dayOfWeek)
                .replace('HH', hours24 < 10 ? '0' + hours24 : hours24)
                .replace('H', hours24)
                .replace('hh', hours12 < 10 ? '0' + hours12 : hours12)
                .replace('h', hours12)
                .replace('m', formattedMinutes)
                .replace('a', ampm);
        }


        // ====== ì¼ì • ì¶”ê°€ ëª¨ë‹¬ í•¨ìˆ˜ (ê¸°ì¡´ calendar.html ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê°€ì ¸ì˜´) ======
        function closeCreateEventModal() {
            document.getElementById('createEventModal').style.display = 'none';
        }

        function saveEvent() {
            const form = document.getElementById("eventForm");
            const formData = new FormData();
            // userIdë‘ workspaceCdëŠ” ì„ì‹œë¡œ ì§€ì •í•´ë†¨ì–´ìš”
            const requestBody = {
                userId: currentUserId, // ì „ì—­ currentUserId ì‚¬ìš©
                workspaceCd: "61e37b28-b4d9-4939-951d-52716ca9b89b",
                title: form.title.value,
                description: form.description.value,
                startDatetime: form.startDatetime.value, // id ë³€ê²½ë¨
                endDatetime: form.endDatetime.value,     // id ë³€ê²½ë¨
                color: form.color.value,
                isShared: form.isShared ? (form.isShared.checked ? '1' : '0') : '0',
                progressStatus: "TODO", // ìƒˆ ì¼ì •ì€ ê¸°ë³¸ TODOë¡œ ê°€ì • (í¼ì— ì—†ìŒ)
                priority: form.priority.value,
                notifyTime: parseInt(form.notification.value) // ìˆ«ìë¡œ ë³€í™˜
            };

            formData.append("request", new Blob([JSON.stringify(requestBody)], { type: "application/json" }));

            const attendenceIds = document.querySelectorAll('input[name="attendenceIds"]:checked');
            attendenceIds.forEach(cb => {
                formData.append('attendenceIds', cb.value);
            });

            const files = form.fileUpload.files; // id ë³€ê²½ë¨
            for (let i = 0; i < files.length; i++) {
                formData.append("files", files[i]);
            }

            fetch('/api/calendar/personal', {
                method: 'POST',
                body: formData
            })
                .then(res => {
                    if (!res.ok) throw new Error('ë“±ë¡ ì‹¤íŒ¨');
                    return res.text();
                })
                .then(data => {
                    alert("ì¼ì • ë“±ë¡ ì„±ê³µ!");
                    location.reload(); // ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨
                })
                .catch(err => {
                    console.error(err);
                    alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
                });

            closeCreateEventModal();
        }

        /* "ì¢…ì¼" ì²´í¬ë°•ìŠ¤ ë¡œì§ (createEventModal ë‚´) */
        const createAllDayCheckbox = document.getElementById('allDay');
        const createStartDatetimeInput = document.getElementById('startDatetime');
        const createEndDatetimeInput = document.getElementById('endDatetime');

        createAllDayCheckbox.addEventListener('change', function () {
            if (this.checked) {
                const startDate = new Date(createStartDatetimeInput.value);
                startDate.setHours(0, 0, 0, 0);

                const endDate = new Date(startDate);
                endDate.setHours(23, 59, 59, 999);

                createStartDatetimeInput.value = formatDateToLocalISO(startDate);
                createEndDatetimeInput.value = formatDateToLocalISO(endDate);
            }
        });

        function formatDateToLocalISO(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // íŒŒì¼ ì²¨ë¶€ ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ íŒŒì¼ëª… í‘œì‹œ ë¡œì§
        document.getElementById('fileUpload').addEventListener('change', function () {
            const insertedFilesUl = document.getElementById('insertedFiles');
            insertedFilesUl.innerHTML = ''; // ê¸°ì¡´ íŒŒì¼ ëª©ë¡ ì´ˆê¸°í™”

            if (this.files.length > 0) {
                for (let i = 0; i < this.files.length; i++) {
                    const li = document.createElement('li');
                    li.textContent = this.files[i].name;
                    insertedFilesUl.appendChild(li);
                }
            }
        });


        // ====== ì¼ì • ìƒì„¸ ëª¨ë‹¬ í•¨ìˆ˜ (ê¸°ì¡´ calendar.html ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê°€ì ¸ì˜´) ======
        function closeDetailModal() {
            document.getElementById('eventDetailModal').style.display = 'none';
        }

        // ====== íŒŒì¼ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ (ê¸°ì¡´ calendar.html ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê°€ì ¸ì˜´) ======
        function downloadFromS3(fileUrl, fileName) {
            fetch(fileUrl)
                .then(response => {
                    if (!response.ok) throw new Error("ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨");
                    return response.blob();
                })
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    a.click();
                    window.URL.revokeObjectURL(url);
                })
                .catch(err => {
                    console.error(err);
                    alert("íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                });
        }

        // ====== ì¼ì • ìˆ˜ì • ëª¨ë‹¬ í•¨ìˆ˜ (ê¸°ì¡´ calendar.html ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê°€ì ¸ì˜´) ======
        let deletedFileIds = []; // ì „ì—­ ë³€ìˆ˜ë¡œ ê´€ë¦¬

        function openUpdateModal() {
            closeCreateEventModal();
            closeDetailModal();

            const data = window.selectedEventData;
            if (!data) {
                alert("ìˆ˜ì •í•  ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            const eventData = data.event;

            // ìˆ˜ì • í¼ì— ê¸°ì¡´ ê°’ ë¶ˆëŸ¬ì˜¤ê¸°
            document.getElementById('update-eventCd').value = eventData.eventCd;
            document.getElementById('update-title').value = eventData.title || '';
            document.getElementById('update-description').value = eventData.description || '';
            document.getElementById('update-startDatetime').value = eventData.startDatetime ? formatDateToLocalISO(new Date(eventData.startDatetime)) : '';
            document.getElementById('update-endDatetime').value = eventData.endDatetime ? formatDateToLocalISO(new Date(eventData.endDatetime)) : '';
            document.getElementById('update-color').value = eventData.color || '#0066CC';
            document.getElementById('update-priority').value = eventData.priority || 'NORMAL';
            document.getElementById('update-progressStatus').value = eventData.progressStatus || 'TODO';
            document.getElementById('update-isShared').value = eventData.isShared === '1' ? '1' : '0'; // '1' ë˜ëŠ” '0'ìœ¼ë¡œ ì„¤ì •
            document.getElementById('update-location').value = data.location || ''; // ìœ„ì¹˜ í•„ë“œ ì¶”ê°€

            // ì•Œë¦¼ ì‹œê°„ ì„¤ì • (notification ë§¤í•‘)
            let notifyTimeVal = eventData.notifyTime;
            // ìº˜ë¦°ë”ì—ì„œ ë„˜ì–´ì˜¨ notifyTime (ë¶„ ë‹¨ìœ„ ìˆ«ì)ì„ select ì˜µì…˜ì˜ valueì™€ ë§¤ì¹­
            let notificationSelect = document.getElementById('update-notification');
            let foundOption = false;
            for (let i = 0; i < notificationSelect.options.length; i++) {
                if (notificationSelect.options[i].value == notifyTimeVal) {
                    notificationSelect.value = notifyTimeVal;
                    foundOption = true;
                    break;
                }
            }
            if (!foundOption) { // ë§¤ì¹­ë˜ëŠ” ì˜µì…˜ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì • (ì˜ˆ: ì•Œë¦¼ ì—†ìŒ)
                notificationSelect.value = '0';
            }


            // ê¸°ì¡´ íŒŒì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ë° ì‚­ì œ ë²„íŠ¼
            const updateFilesUl = document.getElementById('updateFiles');
            updateFilesUl.innerHTML = ''; // ì´ˆê¸°í™”
            deletedFileIds = []; // ì‚­ì œí•  íŒŒì¼ ID ëª©ë¡ ì´ˆê¸°í™”

            if (data.fileList && data.fileList.length > 0) {
                data.fileList.forEach(file => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                  <span>${file.fileNm}</span>
                  <button type="button" class="file-delete-button" data-file-id="${file.fileId}" onclick="markFileForDeletion('${file.fileId}', this)">íŒŒì¼ ì‚­ì œ</button>
              `;
                    updateFilesUl.appendChild(li);
                });
            } else {
                updateFilesUl.innerHTML = '<li>ê¸°ì¡´ ì²¨ë¶€íŒŒì¼ ì—†ìŒ</li>';
            }

            document.getElementById('updateEventModal').style.display = 'flex'; // ëª¨ë‹¬ í‘œì‹œ
        }

        // íŒŒì¼ ì‚­ì œ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ì‚­ì œí•  íŒŒì¼ ì•„ì´ë”” ì„ì‹œë¡œ ì €ì¥
        function markFileForDeletion(fileId, buttonElement) {
            if (!deletedFileIds.includes(fileId)) { // ì¤‘ë³µ ì¶”ê°€ ë°©ì§€
                deletedFileIds.push(fileId);
            }
            buttonElement.closest('li').style.textDecoration = 'line-through';
            buttonElement.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”
            buttonElement.innerText = 'ì‚­ì œ ì˜ˆì •';
        }

        function closeUpdateModal() {
            document.getElementById('updateEventModal').style.display = 'none';
            deletedFileIds = []; // ëª¨ë‹¬ ë‹«ì„ ë•Œ ì‚­ì œ ëª©ë¡ ì´ˆê¸°í™”
            document.getElementById('updateEventForm').reset(); // í¼ ì´ˆê¸°í™”
            document.getElementById('updateFiles').innerHTML = ''; // íŒŒì¼ ëª©ë¡ ì´ˆê¸°í™”
        }

        // ìˆ˜ì •ì‚¬í•­ ì €ì¥ìš©
        function submitUpdateEvent() {
            const form = document.getElementById('updateEventForm');
            const formData = new FormData();
            const eventCd = document.getElementById('update-eventCd').value;

            const requestBody = {
                eventCd: eventCd, // ì´ë¯¸ íˆë“  í•„ë“œì—ì„œ ê°€ì ¸ì˜´
                title: document.getElementById('update-title').value,
                description: document.getElementById('update-description').value,
                startDatetime: document.getElementById('update-startDatetime').value,
                endDatetime: document.getElementById('update-endDatetime').value,
                color: document.getElementById('update-color').value,
                priority: document.getElementById('update-priority').value,
                progressStatus: document.getElementById('update-progressStatus').value,
                isShared: document.getElementById('update-isShared').value,
                userId: currentUserId, // í˜„ì¬ ìœ ì € ID ì‚¬ìš© (ì‘ì„±ì)
                workspaceCd: '61e37b28-b4d9-4939-951d-52716ca9b89b', // ì„ì‹œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì½”ë“œ
                location: document.getElementById('update-location').value, // ìœ„ì¹˜ í•„ë“œ ì¶”ê°€
                notifyTime: parseInt(document.getElementById('update-notification').value) // ìˆ«ìë¡œ ë³€í™˜
            };


            formData.append("request", new Blob([JSON.stringify(requestBody)], { type: "application/json" }));
            formData.append("deletedFileIds", new Blob([JSON.stringify(deletedFileIds)], { type: "application/json" }));

            // ì¶”ê°€ëœ íŒŒì¼ì´ ìˆì„ ê²½ìš°
            const fileInput = form.querySelector('input[name="files"]');
            if (fileInput && fileInput.files.length > 0) {
                for (const file of fileInput.files) {
                    formData.append("files", file);
                }
            }

            fetch(`/api/calendar/personal/events/${eventCd}`, {
                method: 'PUT',
                body: formData
            })
                .then(res => {
                    if (!res.ok) throw new Error("ìˆ˜ì • ì‹¤íŒ¨");
                    return res.text();
                })
                .then(data => {
                    alert("ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    closeUpdateModal();
                    location.reload(); // ë˜ëŠ” FullCalendar ì´ë²¤íŠ¸ ê°±ì‹ 
                })
                .catch(err => {
                    console.error(err);
                    alert("ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                });
        }

        // ====== ì¼ì • ì‚­ì œ í•¨ìˆ˜ (ê¸°ì¡´ calendar.html ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê°€ì ¸ì˜´) ======
        function deleteEvent() {
            const confirmDelete = confirm("ì •ë§ë¡œ ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
            if (confirmDelete) {
                const eventCd = window.selectedEventData?.event?.eventCd;
                if (!eventCd) {
                    alert("ì‚­ì œí•  ì´ë²¤íŠ¸ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                fetch(`/api/calendar/personal/events/${eventCd}`, {
                    method: 'DELETE'
                })
                    .then(res => {
                        if (!res.ok) throw new Error("ì‚­ì œ ì‹¤íŒ¨");
                        return res.text();
                    })
                    .then(data => {
                        alert("ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
                        closeDetailModal();
                        location.reload(); // ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨
                    })
                    .catch(err => {
                        console.error(err);
                        alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    });
            } else {
                console.log("ì‚­ì œ ì·¨ì†Œë¨");
            }
        }
        /*]]>*/
    </script>
</body>

</html>