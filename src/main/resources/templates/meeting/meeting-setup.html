<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회의 준비 - Ocean</title>

    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/meeting-setup.css}">

</head>
<body>
<div class="meeting-setup-container">
    <!-- 헤더 -->
    <div class="setup-header">
        <div class="header-content">
            <button class="back-btn" onclick="history.back()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <h1>회의 준비</h1>
            <span class="workspace-name" th:text="${workspaceName}">워크스페이스명</span>
        </div>
    </div>

    <div class="setup-content">
        <!-- 왼쪽: 미디어 설정 -->
        <div class="left-panel">
            <!-- 카메라 미리보기 -->
            <div class="preview-section">
                <h2>카메라 & 마이크 테스트</h2>
                <div class="video-preview">
                    <video id="localVideo" autoplay muted playsinline></video>
                    <div class="video-placeholder" id="videoPlaceholder">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                        <p>카메라를 시작하려면 아래 버튼을 클릭하세요</p>
                    </div>
                </div>

                <!-- 미디어 컨트롤 -->
                <div class="media-controls">
                    <button id="cameraToggle" class="control-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                        </svg>
                        <span>카메라 켜기</span>
                    </button>
                    <button id="micToggle" class="control-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                        <span>마이크 켜기</span>
                    </button>
                </div>
            </div>

            <!-- 장치 선택 -->
            <div class="device-selection">
                <div class="device-group">
                    <label for="cameraSelect">카메라</label>
                    <select id="cameraSelect" class="device-select">
                        <option value="">카메라를 선택하세요</option>
                    </select>
                </div>

                <div class="device-group">
                    <label for="micSelect">마이크</label>
                    <div class="mic-input-group">
                        <select id="micSelect" class="device-select">
                            <option value="">마이크를 선택하세요</option>
                        </select>
                        <div class="volume-meter">
                            <div class="volume-bar" id="volumeBar"></div>
                        </div>
                    </div>
                </div>

                <div class="device-group">
                    <label for="speakerSelect">스피커</label>
                    <div class="speaker-group">
                        <select id="speakerSelect" class="device-select">
                            <option value="">스피커를 선택하세요</option>
                        </select>
                        <button id="testSpeaker" class="test-btn">테스트</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 오른쪽: 회의 설정 -->
        <div class="right-panel">
            <form id="meetingForm">
                <!-- 회의 정보 -->
                <div class="form-section">
                    <h3>회의 정보</h3>
                    <div class="form-group">
                        <label for="meetingTitle">회의 제목</label>
                        <input type="text"
                               id="meetingTitle"
                               placeholder="예: 주간 팀 미팅"
                               value="스케치 회의 - [[${#temporals.format(#temporals.createNow(), 'MM월 dd일')}]]"
                               required>
                    </div>

                    <div class="form-group">
                        <label for="meetingDesc">회의 설명 <span class="optional">(선택)</span></label>
                        <textarea id="meetingDesc"
                                  rows="3"
                                  placeholder="회의 목적이나 안건을 입력하세요"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="duration">예상 시간</label>
                        <select id="duration" class="form-select">
                            <option value="30">30분</option>
                            <option value="60" selected>1시간</option>
                            <option value="120">2시간</option>
                            <option value="0">제한 없음</option>
                        </select>
                    </div>
                </div>

                <!-- 회의 옵션 -->
                <div class="form-section">
                    <h3>회의 옵션</h3>
                    <div class="option-list">
                        <label class="option-item">
                            <input type="checkbox" id="autoRecord" name="autoRecord">
                            <div class="option-content">
                                <span class="option-title">회의 자동 녹화</span>
                                <span class="option-desc">회의 시작과 동시에 녹화를 시작합니다</span>
                            </div>
                        </label>

                        <label class="option-item">
                            <input type="checkbox" id="muteOnJoin" name="muteOnJoin" checked>
                            <div class="option-content">
                                <span class="option-title">참가자 입장 시 음소거</span>
                                <span class="option-desc">참가자가 음소거 상태로 입장합니다</span>
                            </div>
                        </label>

                        <label class="option-item">
                            <input type="checkbox" id="waitingRoom" name="waitingRoom">
                            <div class="option-content">
                                <span class="option-title">대기실 사용</span>
                                <span class="option-desc">호스트가 승인해야 입장 가능합니다</span>
                            </div>
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="videoQuality">비디오 품질</label>
                        <select id="videoQuality" class="form-select">
                            <option value="auto" selected>자동 (권장)</option>
                            <option value="720">HD (720p)</option>
                            <option value="480">SD (480p)</option>
                            <option value="360">절약 모드 (360p)</option>
                        </select>
                    </div>
                </div>

                <!-- 참가자 초대 -->
                <div class="form-section">
                    <h3>참가자 초대</h3>

                    <!-- 워크스페이스 멤버 -->
                    <div class="member-invite" th:if="${members != null and !members.isEmpty()}">
                        <h4>워크스페이스 멤버</h4>
                        <div class="member-list">
                            <div class="member-item" th:each="member : ${members}">
                                <label class="member-checkbox">
                                    <input type="checkbox"
                                           name="invitedMembers"
                                           th:value="${member.userId}"
                                           th:disabled="${member.userId == currentUserId}">
                                    <img class="member-avatar"
                                         th:src="${member.userImg != null ? member.userImg : '/images/default-avatar.png'}"
                                         th:alt="${member.userNickname}">
                                    <div class="member-info">
                                        <span class="member-name" th:text="${member.userNickname}">멤버명</span>
                                        <span class="member-detail" th:if="${member.deptNm != null or member.position != null}">
                                            <span th:text="${member.deptNm}">부서</span>
                                            <span th:if="${member.position != null}" th:text="' · ' + ${member.position}">직책</span>
                                        </span>
                                        <!-- 온라인/오프라인 상태 표시 제거 -->
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 이메일 초대 -->
                    <div class="email-invite">
                        <h4>이메일로 초대</h4>
                        <div class="email-input-group">
                            <input type="email"
                                   id="inviteEmail"
                                   placeholder="이메일 주소 입력">
                            <button type="button"
                                    id="addEmail"
                                    class="add-btn">추가</button>
                        </div>
                        <div id="emailList" class="email-list"></div>
                    </div>
                </div>

                <!-- 하단 버튼 -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="history.back()">
                        취소
                    </button>
                    <button type="submit" class="btn-primary" id="startMeetingBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                        </svg>
                        회의 시작
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 로딩 오버레이 -->
<div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-content">
        <div class="spinner"></div>
        <p>회의실을 준비하고 있습니다...</p>
    </div>
</div>

<script th:src="@{/js/token.js}"></script>

<!-- Thymeleaf 변수를 JavaScript로 전달 -->
<script th:inline="javascript">
    const workspaceCd = /*[[${workspaceCd}]]*/ '';
    const currentUserId = /*[[${currentUserId}]]*/ '';
    const mediaServerUrl = /*[[${mediaServerUrl}]]*/ '';
</script>

<script src="/js/meeting-setup.js"></script>
</body>
</html>